{% extends "dtd_reports/report-nav.html" %}

{% block report %}

<div class="container p-2 bg-light">
  <div class="row">
    <div class="col">
      <canvas id="call-duration-chart" data-url="{% url 'dtd_reports:call-duration-report-data' %}"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.7.0"></script>
<script>
  $(function() {
    $("#call-duration-per-day-report").addClass("active");
  });

  $(function () {

    var $callDurationChart = $("#call-duration-chart");
    $.ajax({
      url: $callDurationChart.data("url"),
      success: function (data) {

        var ctx = $callDurationChart[0].getContext("2d");

        Chart.scaleService.updateScaleDefaults('linear', {
            ticks: {
                min: 0
            }
        });

        new Chart(ctx, {
          plugins: [ChartDataLabels],
          type: 'bar',
          data: {
            labels: data.labels,
            datasets: [
              {
                label: 'Incoming Calls',
                backgroundColor: 'rgb(0, 206, 209, 0.7)',
                data: data.incoming_calls
              },
              {
                label: 'Outgoing Calls',
                backgroundColor: 'rgb(144, 238, 144, 0.7)',
                data: data.outgoing_calls
              },
              {
                label: 'FTP Calls (Outgoing)',
                backgroundColor: 'rgb(255, 160, 122, 0.7)',
                data: data.ftp_calls
              }
            ]          
          },
          options: {
            responsive: true,
            legend: {
              position: 'top',
            },
            title: {
              display: true,
              text: 'Total Call Duration per Day, by Type'
            },
            tooltips: {
              callbacks: {
                label: (item) => item.yLabel + " minutes"
              }
            },
            plugins: {
              datalabels: {
                color: '#ffffff',
                font: {
                  size: 18,
                  weight: 'bold'
                }
              }
            }
          }
        });

      }
    });

  });
</script>

{% endblock %}